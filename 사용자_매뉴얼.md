# P&ID Smart Digitizer 사용자 매뉴얼

## 🎯 프로그램 소개

P&ID Smart Digitizer는 공정도면(P&ID) PDF 파일에서 엔지니어링 태그와 관계를 자동으로 추출하고 관리할 수 있는 웹 기반 도구입니다. 모든 처리가 브라우저에서 이루어지므로 파일이 외부로 전송되지 않아 보안이 안전합니다.

### 주요 기능
- 🔍 **자동 태그 인식**: Equipment, Line, Instrument, Drawing Number, Notes & Holds 자동 추출
- 🔗 **관계 관리**: 태그 간 연결관계, 설치관계, 주석관계 시각화 및 관리
- 📝 **Description 관리**: Note & Hold 태그와 연관된 설명 텍스트 관리
- ⚙️ **Equipment Short Spec**: 장비 사양서 정보 관리
- 📊 **Excel 내보내기**: 추출된 데이터를 구조화된 Excel 파일로 내보내기
- 💾 **프로젝트 저장**: JSON 형태로 작업 내용 저장 및 불러오기

---

## 🚀 시작하기

### 1. 웹사이트 접속
브라우저에서 다음 주소로 접속하세요:
```
https://khk9897.github.io/P-ID-Tag-Extractor
```

### 2. PDF 파일 업로드
1. 메인 화면의 **"PDF 파일 선택"** 버튼을 클릭하거나 파일을 드래그하여 업로드
2. PDF가 로드되면 자동으로 태그 추출이 시작됩니다
3. 추출 완료 후 왼쪽 사이드 패널에서 인식된 태그들을 확인할 수 있습니다

---

## 📋 인터페이스 구성

### 상단 헤더
- **PDF 컨트롤**: 페이지 이동, 확대/축소, 보기 모드 전환
- **프로젝트 관리**: 저장, 불러오기, 설정, 초기화
- **자동 링크**: Description, Notes & Holds, Equipment Short Spec 자동 연결
- **사이드패널 토글**: 왼쪽 패널 표시/숨김

### 왼쪽 사이드패널
4개의 탭으로 구성:
- **Tags**: 추출된 모든 태그 목록
- **Notes**: Description 목록 (Note & Hold 정보)
- **Equipment Specs**: 장비 사양서 목록  
- **Relations**: 태그 간 관계 목록

### 중앙 PDF 뷰어
- PDF 문서 표시 및 태그 시각화
- 태그 선택, 관계 생성, 수동 태그 생성 기능

### 하단 선택 패널
- 선택된 텍스트로 태그 생성
- 수동 영역 선택으로 태그 생성

---

## 🏷️ 태그 관리

### 태그 카테고리
각 태그는 다음 카테고리로 분류됩니다:

| 카테고리 | 설명 | 색상 | 패턴 예시 |
|---------|------|------|----------|
| **Equipment** | 장비 태그 | 🔵 파란색 | `P-101`, `T-201` |
| **Line** | 배관 라인 | 🔴 빨간색 | `P-101-001-2"-CS` |
| **Instrument** | 계측기기 | 🟡 노란색 | `FT1001`, `PT1002A` |
| **Drawing Number** | 도면번호 | 🟣 보라색 | `P1001-001-001` |
| **Notes & Holds** | 주석/보류사항 | 🟢 초록색 | `NOTE 1`, `HOLD 2` |

### 태그 조작

#### 태그 선택
- **단일 선택**: 태그를 클릭
- **다중 선택**: `Ctrl` + 클릭
- **범위 선택**: `Shift` + 클릭
- **재클릭**: 선택된 태그를 다시 클릭하면 PDF에서 해당 위치로 이동

#### 태그 편집
- 태그에 마우스를 올리면 나타나는 ✏️ **편집** 버튼 클릭
- 텍스트를 수정하고 `Enter`로 저장, `Esc`로 취소

#### 태그 삭제
- 단일 삭제: 태그에 마우스를 올리면 나타나는 🗑️ **삭제** 버튼 클릭
- 대량 삭제: 여러 태그 선택 후 **"Delete Selected (n)"** 버튼 클릭

---

## 🔗 관계 관리

### 관계 유형

#### 1. Connection (연결)
- **용도**: 배관이나 전기 연결을 나타냄
- **생성**: 연결 모드에서 태그를 순서대로 클릭
- **표시**: `A → B` 형태

#### 2. Installation (설치)
- **용도**: 계측기기가 장비나 배관에 설치됨을 나타냄
- **생성**: 연결 모드에서 계측기기 → 설치대상 순으로 클릭
- **표시**: `📌 A installed on B`

#### 3. Annotation (주석)
- **용도**: 태그와 관련 텍스트를 연결
- **생성**: 자동 생성 또는 수동 연결

#### 4. Note (주석관계)
- **용도**: 장비/배관과 Note 태그 연결
- **생성**: Auto Link Notes & Holds 기능 사용

#### 5. Description (설명관계)
- **용도**: Note 태그와 Description 연결
- **생성**: Auto Link Descriptions 기능 사용

#### 6. Equipment Short Spec (장비사양)
- **용도**: Equipment 태그와 장비 사양서 연결
- **생성**: Auto Link Equipment Short Specs 기능 사용

### 관계 생성 방법

#### 자동 연결
상단 헤더의 자동 링크 버튼들:
- **🔗 Auto Link Descriptions**: Note 태그와 Description 자동 연결
- **📝 Auto Link Notes & Holds**: 장비/배관과 Note 태그 자동 연결
- **⚙️ Auto Link Equipment Short Specs**: Equipment 태그와 사양서 자동 연결
- **🔄 Auto Link All**: 위 3개 기능을 한번에 실행

#### 수동 연결
1. 상단 헤더에서 **연결 모드** 활성화
2. 첫 번째 태그 클릭 (시작점)
3. 두 번째 태그 클릭 (끝점)
4. 관계가 자동으로 생성됩니다

---

## 📝 Description 관리

### Description 생성
1. 관련 태그나 텍스트 항목을 선택
2. 키보드 `N` 키를 누르거나 상단 메뉴에서 생성
3. Description 메타데이터 설정:
   - **Type**: Note / Hold
   - **Scope**: General / Specific  
   - **Number**: 페이지별 자동 번호 할당

### Description 편집
1. Notes 탭에서 Description 클릭하여 선택
2. ✏️ **편집** 버튼 클릭
3. 텍스트 및 메타데이터 수정
4. **Save** 버튼으로 저장

### Description 탐색
- Notes 탭에서 Description을 클릭하면 해당 페이지로 이동하며 PDF에서 하이라이트됩니다

---

## ⚙️ Equipment Short Spec 관리

### Short Spec 생성
1. Equipment 태그와 관련 텍스트 항목을 선택
2. 키보드 `P` 키를 누르거나 상단 메뉴에서 생성
3. 원본 Equipment 태그 정보가 자동으로 연결됩니다

### Short Spec 편집
1. Equipment Specs 탭에서 항목 선택
2. ✏️ **편집** 버튼 클릭
3. 장비 태그명과 사양 내용 수정
4. **Save** 버튼으로 저장

### 연결 상태 확인
- 🔗 표시: Equipment 태그와 연결됨
- ⚠️ Unlinked: 연결되지 않은 상태 (수동 연결 필요)

---

## 🔍 검색 및 필터링

### Tags 탭 필터링
- **페이지 필터**: "Show page only" 체크박스로 현재 페이지만 표시
- **카테고리 필터**: All, Equip, Line, Instr, PID NO, Notes 탭으로 필터링
- **텍스트 검색**: 검색창에 태그명 입력으로 필터링

### 정렬 옵션
- **Default (A-Z)**: 알파벳 순서
- **Position (Top → Bottom)**: 문서상 위에서 아래로
- **Position (Left → Right)**: 문서상 왼쪽에서 오른쪽으로
- **Length (Short → Long)**: 텍스트 길이 짧은 순
- **Length (Long → Short)**: 텍스트 길이 긴 순

### Relations 탭 검색
- 관계 목록에서 태그명으로 검색 가능
- 관련 태그를 클릭하면 해당 태그로 바로 이동

---

## ⌨️ 키보드 단축키

| 키 | 기능 |
|---|------|
| `N` | 선택된 항목으로 Description 생성 |
| `P` | 선택된 Equipment 태그와 텍스트로 Short Spec 생성 |
| `Ctrl + 클릭` | 다중 선택 |
| `Shift + 클릭` | 범위 선택 |
| `Enter` | 편집 모드에서 저장 |
| `Esc` | 편집 모드에서 취소 |

---

## 📊 데이터 내보내기

### Excel 내보내기
사이드패널 하단의 **"Export to Excel"** 버튼을 클릭하면 다음 워크시트가 포함된 Excel 파일이 생성됩니다:

#### 워크시트 구성
1. **Equipment**: 장비 태그 목록과 연결된 계측기기, 관련 Description
2. **Line**: 배관 라인 목록과 연결 관계, 관련 Description  
3. **Instrument**: 계측기기 목록과 설치 위치, 관련 Description
4. **Description**: Description 목록과 연결된 태그들

#### 데이터 항목
- 태그 텍스트, 카테고리, 페이지 번호
- 연결된 태그들 (Connection, Installation 관계)
- 관련 Description (Note/Hold 정보)
- 도면번호 (페이지별)

### 프로젝트 저장/불러오기
- **저장**: 상단 **"Export Project"** 버튼으로 JSON 파일 다운로드
- **불러오기**: 상단 **"Import Project"** 버튼으로 이전 작업 복원

---

## ⚙️ 설정 사용자화

### 패턴 설정
상단 **설정** 버튼에서 각 카테고리별 인식 패턴을 수정할 수 있습니다:

#### Equipment 패턴
- **기본값**: `^([^-]*-){2}[^-]*$`
- **예시**: `P-101`, `T-201`, `C-301`

#### Line 패턴  
- **기본값**: `^([^-]*-){3,}[^-]*$`
- **예시**: `P-101-001-2"-CS`, `T-201-002-4"-SS`

#### Instrument 패턴
- **Function**: `[A-Z]{2,4}` (예: FT, PT, TT)
- **Number**: `\\d{4}(?:\\s?[A-Z])?` (예: 1001, 1002A)
- **결합 예시**: `FT1001`, `PT1002A`

#### Drawing Number 패턴
- **기본값**: `[A-Z\\d-]{5,}-[A-Z\\d-]{5,}-\\d{3,}`
- **예시**: `P1001-001-001`, `T2001-002-100`

#### Notes & Holds 패턴
- **기본값**: `^(NOTE|HOLD).*`
- **예시**: `NOTE 1`, `HOLD 2`

### 허용 오차 설정
Instrument 태그 조합을 위한 공간적 허용 오차:
- **Vertical**: 15px (수직 방향)
- **Horizontal**: 20px (수평 방향)  
- **Auto Link Distance**: 30px (자동 연결 거리)

---

## 🎨 사용자 인터페이스 가이드

### 사이드패널 사용법

#### Tags 탭
- **View Options 섹션**: 관계 표시, 상세 정보, 정렬 옵션 설정
- **카테고리 필터**: 상단 탭으로 빠른 필터링
- **태그 목록**: 각 태그의 관계 정보를 펼쳐서 확인 가능

#### Notes 탭  
- **Description 카드**: 클릭하면 해당 위치로 이동
- **편집 모드**: ✏️ 버튼으로 내용 및 메타데이터 수정
- **타입/범위 설정**: Note/Hold, General/Specific 선택

#### Equipment Specs 탭
- **장비 사양서**: 원본 Equipment 태그와 연결된 사양 정보
- **연결 상태**: 🔗 연결됨 / ⚠️ 연결 안됨 표시
- **편집 가능**: 장비명과 사양 내용 수정

#### Relations 탭
- **관계 목록**: 모든 태그 간 관계 표시
- **검색 기능**: 태그명으로 관계 검색
- **클릭 네비게이션**: 관계에서 태그 클릭 시 해당 태그로 이동

### PDF 뷰어 기능

#### 보기 모드
- **Select**: 태그 선택 및 텍스트 선택 모드
- **Connect**: 태그 간 관계 생성 모드  
- **Manual Create**: 수동 영역 선택으로 태그 생성 모드

#### 시각적 표시
- **태그 하이라이트**: 카테고리별 색상으로 구분
- **관계 라인**: 태그 간 연결선 표시 (토글 가능)
- **선택 표시**: 선택된 태그는 빨간색 테두리
- **핑 애니메이션**: 클릭된 태그 2초간 깜빡임

---

## 💡 작업 플로우 가이드

### 기본 작업 순서

#### 1단계: PDF 업로드 및 자동 추출
1. PDF 파일 업로드
2. 자동 태그 추출 완료 대기
3. 사이드패널에서 추출 결과 확인

#### 2단계: 태그 정리 및 수정
1. 잘못 인식된 태그 삭제 또는 수정
2. 누락된 태그를 수동으로 생성
3. 카테고리별로 태그 검토 및 정리

#### 3단계: 관계 생성
1. **Auto Link All** 버튼으로 자동 관계 생성
2. 수동으로 누락된 관계 추가:
   - 연결 모드에서 태그 간 Connection/Installation 생성
   - 필요시 관계 삭제 및 수정

#### 4단계: Description 및 Spec 관리
1. Notes & Holds 태그와 Description 연결 확인
2. Equipment Short Spec 생성 및 연결
3. 내용 편집 및 메타데이터 정리

#### 5단계: 검토 및 내보내기
1. Relations 탭에서 전체 관계 검토
2. Excel로 내보내기
3. 프로젝트 JSON 파일로 저장

### 효율적인 작업 팁

#### 대량 데이터 처리
- **페이지별 작업**: "Show page only" 활용하여 페이지별로 순차 작업
- **카테고리별 검토**: 카테고리 필터를 활용하여 체계적 검토
- **검색 활용**: 특정 태그나 관계를 빠르게 찾기

#### 품질 확보
- **Auto Link 후 검토**: 자동 연결 후 잘못된 연결 수정
- **관계 검증**: Relations 탭에서 논리적 타당성 검토
- **Description 내용 확인**: 연결된 Description의 정확성 검토

---

## 🛠️ 고급 기능

### 수동 태그 생성
1. **Manual Create** 모드로 전환
2. PDF에서 영역을 드래그하여 선택
3. 하단 패널에서 텍스트와 카테고리 입력
4. **Create Tag** 버튼으로 생성

### Raw Text 활용
1. 추출된 Raw Text에서 유용한 정보 식별
2. 해당 텍스트를 선택하여 태그로 변환
3. 기존 태그와 Annotation 관계로 연결

### 관계선 시각화
- **Show relationship lines** 체크박스로 PDF상에 관계선 표시
- Connection: 실선 화살표
- Installation: 점선 연결
- 복잡한 관계를 시각적으로 확인 가능

---

## 📋 Excel 출력 형식 상세

### Equipment 워크시트
| 열 | 내용 |
|---|------|
| Equipment Tag | 장비 태그명 |
| Page | 페이지 번호 |
| Drawing Number | 해당 페이지 도면번호 |
| Connected To | 연결된 다른 장비 |
| Installed Instruments | 설치된 계측기기 목록 |
| Related Descriptions | 연관된 Note/Hold Description |

### Line 워크시트  
| 열 | 내용 |
|---|------|
| Line Tag | 배관 라인명 |
| Page | 페이지 번호 |
| Drawing Number | 해당 페이지 도면번호 |
| Connected To | 연결된 장비/배관 |
| Related Descriptions | 연관된 Note/Hold Description |

### Instrument 워크시트
| 열 | 내용 |
|---|------|
| Instrument Tag | 계측기기 태그명 |
| Page | 페이지 번호 |
| Drawing Number | 해당 페이지 도면번호 |
| Installed On | 설치 위치 (장비/배관) |
| Connected To | 연결된 다른 계측기기 |
| Related Descriptions | 연관된 Note/Hold Description |

### Description 워크시트
| 열 | 내용 |
|---|------|
| Type | Note 또는 Hold |
| Number | 번호 (페이지별) |
| Scope | General 또는 Specific |
| Page | 페이지 번호 |
| Description Text | Description 내용 |
| Related Tags | 연관된 태그 목록 |

---

## 🔧 문제 해결

### 자주 발생하는 문제

#### "태그가 인식되지 않아요"
**해결방법:**
1. 설정에서 해당 카테고리의 패턴 확인
2. 패턴을 실제 태그 형식에 맞게 수정
3. PDF 품질이 낮은 경우 수동으로 태그 생성

#### "관계가 자동으로 생성되지 않아요"
**해결방법:**
1. 태그가 올바른 카테고리로 분류되었는지 확인
2. Instrument의 경우 허용 오차 설정 확인
3. 수동으로 관계 생성 후 패턴 분석

#### "Excel 내보내기에 데이터가 누락되어요"
**해결방법:**
1. Relations 탭에서 모든 관계가 올바르게 생성되었는지 확인
2. Description과 Equipment Short Spec이 태그와 연결되었는지 확인
3. Auto Link 기능을 다시 실행

#### "페이지가 많은 PDF에서 느려져요"
**해결방법:**
1. "Show page only" 옵션을 활성화하여 페이지별로 작업
2. 불필요한 Raw Text 삭제하여 메모리 절약
3. 작업 완료된 관계는 정기적으로 검토하여 중복 제거

### 성능 최적화 팁
- **적정 규모**: 페이지당 200개 미만의 태그 권장
- **정기 저장**: 프로젝트를 주기적으로 저장하여 작업 손실 방지
- **브라우저 메모리**: 탭을 너무 많이 열지 말고 전용 브라우저 사용 권장

---

## 📞 지원 및 피드백

### 문제 신고
프로그램 사용 중 문제가 발생하면:
1. 브라우저 개발자 도구(F12)에서 콘솔 오류 확인
2. 문제 상황과 오류 메시지를 GitHub Issues에 신고
3. 가능하면 문제 재현 단계도 함께 제공

### 기능 요청
새로운 기능이나 개선사항이 있으면 GitHub Issues에 제안해주세요.

---

## 📚 부록

### 정규표현식 가이드
패턴 설정 시 참고할 정규표현식 문법:

| 패턴 | 의미 | 예시 |
|------|------|------|
| `^` | 문자열 시작 | `^P` = P로 시작 |
| `$` | 문자열 끝 | `1$` = 1로 끝남 |
| `[A-Z]` | 대문자 알파벳 | `[A-Z]{2}` = 2자리 대문자 |
| `\\d` | 숫자 | `\\d{4}` = 4자리 숫자 |
| `.*` | 임의 문자 | `NOTE.*` = NOTE로 시작하는 모든 문자 |
| `{n}` | 정확히 n개 | `[A-Z]{3}` = 정확히 3개 대문자 |
| `{n,}` | n개 이상 | `\\d{3,}` = 3자리 이상 숫자 |
| `?` | 0개 또는 1개 | `\\s?` = 공백 있거나 없거나 |

### 색상 코드 참조
각 카테고리별 색상은 코드에서 자동으로 할당됩니다:
- Equipment: 하늘색 (Sky Blue)
- Line: 장미색 (Rose)  
- Instrument: 호박색 (Amber)
- Drawing Number: 남색 (Indigo)
- Notes & Holds: 청록색 (Teal)

---

**P&ID Smart Digitizer v1.0.0**  
*엔지니어링 문서 디지털화의 새로운 기준*

💡 **팁**: 이 매뉴얼을 프린트하여 책상에 두고 참고하시면 더욱 효율적으로 작업하실 수 있습니다!